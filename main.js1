"use strict";function writeNewPost(a,b,c,d,e){var f={author:b,uid:a,body:e,title:d,starCount:0,authorPic:c},g=firebase.database().ref().child("posts").push().key,h={};return h["/posts/"+g]=f,h["/user-posts/"+a+"/"+g]=f,firebase.database().ref().update(h)}function toggleStar(a,b){a.transaction(function(a){return a&&(a.stars&&a.stars[b]?(a.starCount--,a.stars[b]=null):(a.starCount++,a.stars||(a.stars={}),a.stars[b]=!0)),a})}function createheaders(a,b,c,d){var f=(firebase.auth().currentUser.uid,'<div class="post  mdl-grid mdl-js-ripple-effect" style="background:#fdfdfd;border-bottom:1px solid #ededed;"> <div class="avatar" style=""></div>'+c+"<br>"+b+"<br>"+d+"</div>"),g=document.createElement("div");g.innerHTML=f;var h=g.firstChild;return h.getElementsByClassName("avatar")[0].style.backgroundImage='url("./silhouette.jpg")',h.onclick=function(){"#e7ebec"!=this.style.backgroundColor?(konu=b,h.backgroundColor="#ccc",this.style.backgroundColor="#e7ebec"):(h.backgroundColor="#e7ebec",this.style.backgroundColor="#ccc");var d=(firebase.auth().currentUser.uid,firebase.database().ref("messages/AGA Clinical Trials/"+a+"/"+b));namer=a;var e=function(a,b){a.orderByChild("timeStamp").on("child_added",function(a){console.log(a.val());var d=(a.val().senderName,b.getElementsByClassName("posts-container")[0]);d.insertBefore(createPostElement(a.key,a.val().timeStamp,a.val().text,a.val().senderName,a.val().SenderId,a.val().timeStamp),d.firstChild)})};topUserPostsSectionleft.getElementsByClassName("posts-container")[0].innerHTML="",e(d,topUserPostsSectionleft),console.log("mesage load start to right panel")},h}function createPostElement(a,b,c,d,e,f){firebase.auth().currentUser.uid;if("AGA Clinical Trials"==d)var h='<div class=" mdl-grid " style="padding-left:14px;float:right;    clear: both;    "><div class="text talk-bubble  tri-right right-top mdl-color-text--black" style="background: #a9cce3;clear: both;"></div></div>';else var h='<div class="  mdl-grid " style="padding-left:14px;float:left;    clear: both; "><div class="avatar"></div><div class="text talk-bubble  tri-right left-top mdl-color-text--black" style="clear: both;"></div></div>';var i=document.createElement("div");i.innerHTML=h;var j=i.firstChild;return componentHandler,j.getElementsByClassName("text")[0].innerText=c,j}function createNewComment(a,b,c,d){firebase.database().ref("post-comments/"+a).push({text:d,author:b,uid:c})}function updateStarredByCurrentUser(a,b){b?(a.getElementsByClassName("starred")[0].style.display="inline-block",a.getElementsByClassName("not-starred")[0].style.display="none"):(a.getElementsByClassName("starred")[0].style.display="none",a.getElementsByClassName("not-starred")[0].style.display="inline-block")}function updateStarCount(a,b){a.getElementsByClassName("star-count")[0].innerText=b}function addCommentElement(a,b,c,d){var e=document.createElement("div");e.classList.add("comment-"+b),e.innerHTML='<span class="username"></span><span class="comment"></span>',e.getElementsByClassName("comment")[0].innerText=c,e.getElementsByClassName("username")[0].innerText=d;var f=a.getElementsByClassName("comments-container")[0];f.appendChild(e)}function setCommentValues(a,b,c,d){var e=a.getElementsByClassName("comment-"+b)[0];e.getElementsByClassName("comment")[0].innerText=c,e.getElementsByClassName("fp-username")[0].innerText=d}function deleteComment(a,b){var c=a.getElementsByClassName("comment-"+b)[0];c.parentElement.removeChild(c)}function startDatabaseQueries(){var a=firebase.auth().currentUser.uid,b=firebase.database().ref("messages/AGA Clinical Trials"),e=(firebase.database().ref("posts").limitToLast(100),firebase.database().ref("user-posts/"+a),[]),f=[],h=function(a,b,c,d){a.orderByChild("timeStamp").on("child_added",function(a){a.val().senderName,b.getElementsByClassName("posts-container")[0];console.log(a.key);var f=b.getElementsByClassName("posts-containerleft")[0];if(!c.includes(a.key)){c.push(a.key);var g=a.key;firebase.database().ref("users/").on("child_added",function(b){b.key==g&&(console.log(b.key),console.log(b.val().firstName+" "+b.val().lastName),firebase.database().ref("messages/AGA Clinical Trials/"+g).on("child_added",function(c){console.log(c.key),firebase.database().ref("messages/AGA Clinical Trials/"+g+"/"+c.key).on("child_added",function(d){f.insertBefore(createheaders(a.key,c.key,b.val().firstName+" "+b.val().lastName,d.val().text),f.firstChild)})}))})}})};h(b,topUserPostsSectionleft,e,f),listeningFirebaseRefs.push(b)}function writeUserData(a,b,c,d){firebase.database().ref("users/"+a).set({uid:a,username:b,email:c,profile_picture:d,firebaseid:""})}function cleanupUi(){topUserPostsSection.getElementsByClassName("posts-container")[0].innerHTML="",recentPostsSection.getElementsByClassName("posts-container")[0].innerHTML="",userPostsSection.getElementsByClassName("posts-container")[0].innerHTML="",listeningFirebaseRefs.forEach(function(a){a.off()}),listeningFirebaseRefs=[]}function onAuthStateChanged(a){a&&currentUID===a.uid||(cleanupUi(),a?(currentUID=a.uid,splashPage.style.display="none",writeUserData(a.uid,a.displayName,a.email,a.photoURL),startDatabaseQueries()):(currentUID=null,splashPage.style.display=""))}function newPostForCurrentUser(a,b){var c=firebase.auth().currentUser.uid;return firebase.database().ref("/users/"+c).once("value").then(function(c){var d=c.val().username;return writeNewPost(firebase.auth().currentUser.uid,d,firebase.auth().currentUser.photoURL,a,b)})}function showSection(a,b){recentPostsSection.style.display="none",userPostsSection.style.display="none",topUserPostsSection.style.display="none",addPost.style.display="none",myTopPostsMenuButton.classList.remove("is-active"),a&&(a.style.display="block"),b&&b.classList.add("is-active")}var messageForm=document.getElementById("message-form"),messageInput=document.getElementById("new-post-message"),titleInput=document.getElementById("new-post-title"),signInButton=document.getElementById("sign-in-button"),signOutButton=document.getElementById("sign-out-button"),splashPage=document.getElementById("page-splash"),addPost=document.getElementById("add-post"),addButton=document.getElementById("add"),recentPostsSection=document.getElementById("recent-posts-list"),userPostsSection=document.getElementById("user-posts-list"),topUserPostsSection=document.getElementById("top-user-posts-list"),topUserPostsSectionleft=document.getElementById("top-user-posts-listleft"),sendbutton=document.getElementById("sendbutton"),sendmessage=document.getElementById("message"),usr=document.getElementById("usr"),pwd=document.getElementById("pwd"),cltlink=document.getElementById("cltlink"),applink=document.getElementById("applink"),application=document.getElementById("application"),header=document.getElementById("header"),so=document.getElementById("so"),namer="",myTopPostsMenuButton=document.getElementById("menu-my-top-posts"),listeningFirebaseRefs=[];cltlink.onclick=function(){topUserPostsSectionleft.style.display="none",topUserPostsSection.style.display="none",recentPostsSection.style.display="none",userPostsSection.style.display="none",topUserPostsSection.style.display="none",addPost.style.display="none",myTopPostsMenuButton.classList.remove("is-active"),clt.style.display="visible"};var konu="";sendbutton.onclick=function(){var a=new Date,b=a.toISOString(),c=new Date("2013-08-15T17:00:00Z");c.toISOString();""!=konu&&(firebase.database().ref("messages/AGA Clinical Trials/"+namer+"/"+konu).push({text:sendmessage.value,senderName:"AGA Clinical Trials",senderId:"12",timeStamp:b}),sendmessage.value="")};var fruits=[],uniq=[],currentUID;window.addEventListener("load",function(){signInButton.addEventListener("click",function(){var a=new firebase.auth.GoogleAuthProvider;""==pwd.value||""==usr.value?alert("please check your login/password"):firebase.auth().signInWithPopup(a),pwd.innerHTML,usr.innerHTML}),applink.addEventListener("click",function(){splashPage.style.display="none",topUserPostsSectionleft.style.display="none",topUserPostsSection.style.display="none",header.style.display="none",recentPostsSection.style.display="none",userPostsSection.style.display="none",topUserPostsSection.style.display="none",addPost.style.display="none",application.style.display="visible"}),so.addEventListener("click",function(){var a=confirm("SESSION WILL BE CLOSED! ARE YOU SURE?");1==a&&firebase.auth().signOut()}),firebase.auth().onAuthStateChanged(onAuthStateChanged),messageForm.onsubmit=function(a){a.preventDefault();var b=messageInput.value,c=titleInput.value;b&&c&&(newPostForCurrentUser(c,b).then(function(){myPostsMenuButton.click()}),messageInput.value="",titleInput.value="")},myTopPostsMenuButton.onclick=function(){showSection(topUserPostsSectionleft,myTopPostsMenuButton)},myTopPostsMenuButton.onclick()},!1);